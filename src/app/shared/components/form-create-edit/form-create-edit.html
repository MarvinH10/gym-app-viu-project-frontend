<form [formGroup]="form" (ngSubmit)="onSubmit()" class="flex flex-col gap-6">
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    @for (field of fields(); track field.name) {
      <div class="flex flex-col gap-2" [class.md:col-span-2]="field.colSpan === 2">
        <label z-label>
          {{ field.label }}
          <span *ngIf="field.validators" class="text-destructive">*</span>
        </label>

        @switch (field.type) {
          @case ('text') {
            <input
              z-input
              type="text"
              [formControlName]="field.name"
              [placeholder]="field.placeholder || ''"
            />
          }
          @case ('email') {
            <input
              z-input
              type="email"
              [formControlName]="field.name"
              [placeholder]="field.placeholder || ''"
            />
          }
          @case ('date') {
            <z-date-picker
              [formControlName]="field.name"
              class="w-full"
              [placeholder]="field.placeholder || 'Seleccionar fecha'"
              zFormat="dd/MM/yyyy"
            ></z-date-picker>
          }
          @case ('select') {
            <z-select [formControlName]="field.name">
              <z-select-item [zValue]="''">Seleccionar...</z-select-item>
              @if (field.options) {
                @for (opt of field.options; track opt.value) {
                  <z-select-item [zValue]="opt.value">{{ opt.label }}</z-select-item>
                }
              }
            </z-select>
          }
          @case ('textarea') {
            <textarea
              z-input
              [formControlName]="field.name"
              rows="3"
              [placeholder]="field.placeholder || ''"
            ></textarea>
          }
        }

        @if (isInvalid(field.name)) {
          <p class="text-xs text-destructive">
            Por favor ingresa un {{ field.label.toLowerCase() }} v√°lido.
          </p>
        }
      </div>
    }
  </div>

  <div class="flex items-center justify-end gap-4 mt-4 pt-6 border-t border-border">
    <button z-button zType="ghost" type="button" (click)="onCancel()" [disabled]="isSubmitting()">
      Cancelar
    </button>
    <button
      z-button
      zType="default"
      type="submit"
      [disabled]="form.invalid || isSubmitting()"
      class="min-w-32"
    >
      @if (isSubmitting()) {
        <span>Guardando...</span>
      } @else {
        <span>Guardar</span>
      }
    </button>
  </div>
</form>
